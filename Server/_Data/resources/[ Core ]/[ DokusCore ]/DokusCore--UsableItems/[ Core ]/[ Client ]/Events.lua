--------------------------------------------------------------------------------
---------------------------------- DokusCore -----------------------------------
--------------------------------------------------------------------------------
----------------------- I feel a disturbance in the force ----------------------
--------------------------------------------------------------------------------
RegisterNetEvent('DokusCore:UsableItems:UseItem', function(Data)
  local PedID, Item, Amount = PedID(), Data.Item, Data.Amount
  local Items = TCTCC('DokuCore:Sync:Get:ModuleData').UsableItems

  for k, v in pairs(Items) do
    if (Low(Item) == Low(v.Item)) then
      local IsMeta, Meta = v.Metabolism, {}
      local Type, CanPlace = Low(v.Type), v.CanPlace
      local ConvA, InvLimit = v.CA, v.InvLimit
      local Prop, PropPos, Ani, AniTime = v.Prop, v.PropPos, v.Animation, v.AniTime
      local Hunger, Thirst, Stamina, Health = v.Hunger, v.Thirst, v.Stamina, v.Health
      local GHI, GHO, GSI, GSO = v.GHI, v.GHO, v.GSI, v.GSO
      local IsEvent, Event = v.UseEvent, v.Event
      if (IsMeta == 0)   then IsMeta = false end
      if (IsMeta == 1)  then IsMeta  = true  end
      if (IsEvent == 0) then IsEvent = false end
      if (IsEvent == 1) then IsEvent = true  end

      if (IsMeta) then
        table.insert(Meta, {
          Hunger = Hunger, Thirst = Thirst,
          Stamina = Stamina, Health = Health,
          GHI = GHI, GHO = GHO, GSI = GSI, GSO = GSO,
          Amount = Amount
        })
      end

      -- Stop on errors
      if ((IsEvent) and (Event == nil)) then ErrorMsg('NoEventInDB') end

      -- Impact metabolism if the item is set to do so.
      if (IsMeta) then ApplyMetabolism(Meta) end

      -- Execute when item has an event
      if (IsEvent) then
        local Dec    = Decoded(Event)
        local Delete = (Dec.Delete or true)
        if (Low(Dec.Type) == 'client') then TriggerEvent(Dec.Event, v, k) end
        if (Low(Dec.Type) == 'server') then TriggerServerEvent(Dec.Event, v, k) end
        if (Delete) then DelInv(PedID, Amount, v) end
      end

      -- Execute animation is the item has one.
      if ((Prop ~= nil) or (Ani ~= nil)) then
        local Del = false
        if (Type == 'deployable') then TaskPlaceWithProp(PedID, Prop, Ani, AniTime, IsMeta, Meta) Del = true end
        if (Type == 'consumable') then TaskConsumeItem(PedID, Prop, PropPos, Ani, IsMeta, Meta) Del = true end

        if (Type == 'instrument') then
          if (Item == 'trumpet') then TriggerEvent('DokuCore:ScriptBundle:Trumpet:Play', { Ani }) end
        end

        if (Del) then DelInv(PedID, Amount, v) end
      end
    end
  end


end)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

























--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
