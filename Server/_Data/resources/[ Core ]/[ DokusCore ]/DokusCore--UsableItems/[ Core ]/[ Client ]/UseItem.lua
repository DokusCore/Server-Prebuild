--------------------------------------------------------------------------------
---------------------------------- DokusCore -----------------------------------
--------------------------------------------------------------------------------
----------------------- I feel a disturbance in the force ----------------------
--------------------------------------------------------------------------------
RegisterNetEvent('DokusCore:UsableItems:UseItem', function(Data)
  local PedID, Item, Amount = PedID(), Data.Item, Data.Amount
  local Items = TCTCC('DokuCore:Sync:Get:ModuleData').UsableItems
  local Sync = TCTCC('DokusCore:Sync:Get:UserData')

  for k,v in pairs(Items) do
    if (Low(v.Item) == Low(Item)) then
      IsPlacing = true
      local Type, Delete = Low(v.Type), v.Delete
      local IsMeta, Meta = v.UseMeta, {}
      local IsEvent, Event = v.UseEvent, v.Event
      local IsAnim, Anim = v.UseAnim, v.Animation
      local Hunger, Thirst, Stamina, Health = v.Hunger, v.Thirst, v.Stamina, v.Health
      local GHI, GHO, GSI, GSO = v.GHI, v.GHO, v.GSI, v.GSO

      if (IsMeta == 0)  then IsMeta  = false end
      if (IsMeta == 1)  then IsMeta  = true  end
      if (IsEvent == 0) then IsEvent = false end
      if (IsEvent == 1) then IsEvent = true  end
      if (IsAnim == 0)  then IsAnim  = false end
      if (IsAnim == 1)  then IsAnim  = true  end
      if (Delete == 0)  then Delete  = false end
      if (Delete == 1)  then Delete  = true  end

      -- ERROR: When event is turned on but no event supplied
      if ((IsEvent) and (Event == nil)) then ErrorMsg('NoEventInDB') end

      -- Store Metabolism data
      if (IsMeta) then
        table.insert(Meta, {
          Hunger = Hunger, Thirst = Thirst,
          Stamina = Stamina, Health = Health,
          GHI = GHI, GHO = GHO, GSI = GSI, GSO = GSO,
          Amount = Amount
        })
      end

      -- Execute animation is the item has one.
      if (IsAnim) then
        local Dec = Decoded(Anim)
        local Ani, Time, Prop, Pos = Dec.Anim, Dec.Time, Dec.Prop, Dec.PropPos
        if ((Ani) and (Prop == nil) and (Time == nil)) then AnimWithoutPropAndTime(PedID, Ani) end
        if ((Ani) and (Prop ~= nil) and (Time == nil)) then AniWithPropAndNoTime(PedID, Ani, Prop, Pos) end
        if ((Ani) and (Prop ~= nil) and (Time ~= nil)) then AniWithPropAndTime(PedID, Ani, Prop, Pos, Time) end
      end

      -- Apply Metabolism
      if (IsMeta) then ApplyMetabolism(Meta) end

      -- Execute when item has an event
      if (IsEvent) then
        local Dec    = Decoded(Event)
        if (Low(Dec.Type) == 'client') then TriggerEvent(Dec.Event, v, k) end
        if (Low(Dec.Type) == 'server') then TriggerServerEvent(Dec.Event, v, k) end
      end

      -- Delete item if item is set to be deleted at use
      if (Delete) then DelInv(PedID, Amount, v) end

      -- Update DataSync with the newly placed Object.
      local IntObjs = {}
      for k,v in pairs(_UsableItems.Interactables) do Tabi(IntObjs, Low(k)) end
      local Contain = ArrayContains(IntObjs, Low(Item))
      if (Contain) then
        for k,v in pairs(_UsableItems.Interactables) do
          if (Low(k) == Low(Item)) then
            local Unix = TSC('DokusCore:Core:System:GetUnix')
            local Time = (v.ExpTime * 60)
            local Meta = { Active = true, InUse = false, Expire = (Unix + Time), Time = Time }
            local Encode = Encoded(Meta)
            local Index = { ObjID, Item, ObjPos, Encode }
            TriggerServerEvent('DokusCore:Sync:Set:ObjectData', { 'Interactable', Index })
            local Index = { Sync.SteamID, false, Low(Item), ObjID, ObjHash, Encoded({Coords=ObjPos}), (Unix + Time), '[]' }
            TriggerServerEvent('DokusCore:Core:DBIns:Objects', Index)
          end
        end
      end

      ObjID, ObjPos, ObjHash = nil, nil, nil
      SyncIntObj()
      IsPlacing = false
    end
  end
end)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

























--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
