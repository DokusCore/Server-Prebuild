------------------------------------------------------------------------------
-------------------------------- DokusCore -----------------------------------
------------------------------------------------------------------------------
--------------------- I feel a disturbance in the force ----------------------
------------------------------------------------------------------------------
Blips, Loc          = {}, nil
HouseID, HouseDoors = nil, {}
SteamID, CharID     = nil, nil
IsInspecting        = false
ShowPrompts         = false
PausePrompts        = false
ShowDoorToggle      = false
ShowBuyInfo         = false
------------------------------------------------------------------------------
------------------------------------------------------------------------------
Areas = _Properties.Areas
Doors = _Properties.Doors
Taxes = _Properties.Taxes
Safes = _Properties.Safes
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
Prompt_DoorLock    = nil
Prompt_OpenStorage = nil
Prompt_BuyHouse    = nil
Prompt_BuyInspect  = nil
Prompt_BuyConYes   = nil
Prompt_BuyConNo    = nil
Prompt_InspectStop = nil
Group              = GetRandomIntInRange(0, 0xffffff)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
CreateThread(function()
  if (_Modules.Properties) then
    while (not FrameReady()) do Wait(1000) end
    while (not UserInGame()) do Wait(1000) end
    for k,v in pairs(Areas) do
      Tabi(Blips, SetBlip(v.Coords, 1586273744, 1.0, v.Type))
    end
  end
end)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
CreateThread(function()
  if (_Modules.Properties) then
    if (_Properties.CloseDoorsOnRestart) then
      local FirstStart = TSC('DokusCore:Properties:Get:FirstStart')
      if (not (FirstStart)) then
        for k,v in pairs(Doors) do
          TriggerEvent('DokusCore:DoorLocks:Sync:Lock:Status', { HID = v.Hash, Status = 1 })
        end
        TriggerServerEvent('DokusCore:Properties:Set:FirstStart')
      end
    end
  end
end)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
AddEventHandler('onResourceStop', function(Name)
  if (GetCurrentResourceName() ~= Name) then return end
  if (#Blips >= 1) then for k,v in pairs(Blips) do RemoveBlip(v) end end
  Blips = {}
  ResetPrompts()
end)
------------------------------------------------------------------------------
------------------------------------------------------------------------------
-- Check distance to the house doors
CreateThread(function()
  if (_Modules.Properties) then
    while not FrameReady() do Wait(1000) end
    while not UserInGame() do Wait(1000) end
    while true do Wait(1000)
      if (HouseID ~= nil) then
        for k,v in pairs(HouseDoors) do
          local Coords = FormatCoords(v.Coords)
          local Dist = GetDistance(Coords)
          if ((Loc == nil) and (Dist <= 2.0)) then Loc = v.KeyID end
          if ((Loc ~= nil) and (Loc == v.KeyID)) then
            if ((Dist > 2.0) and (NearDoor)) then SetLeftDoor() end
            if ((Dist <= 2.0) and (not (NearDoor))) then SetNearDoor() end
          end
        end
      end
    end
  end
end)
------------------------------------------------------------------------------
------------------------------------------------------------------------------

------------------------------------------------------------------------------
------------------------------------------------------------------------------

------------------------------------------------------------------------------
------------------------------------------------------------------------------

------------------------------------------------------------------------------
------------------------------------------------------------------------------

------------------------------------------------------------------------------
------------------------------------------------------------------------------

------------------------------------------------------------------------------
------------------------------------------------------------------------------

------------------------------------------------------------------------------
------------------------------------------------------------------------------

------------------------------------------------------------------------------
------------------------------------------------------------------------------

------------------------------------------------------------------------------
------------------------------------------------------------------------------

------------------------------------------------------------------------------
------------------------------------------------------------------------------

------------------------------------------------------------------------------
------------------------------------------------------------------------------

------------------------------------------------------------------------------
------------------------------------------------------------------------------

------------------------------------------------------------------------------
------------------------------------------------------------------------------

------------------------------------------------------------------------------
------------------------------------------------------------------------------

------------------------------------------------------------------------------
------------------------------------------------------------------------------

------------------------------------------------------------------------------
------------------------------------------------------------------------------

------------------------------------------------------------------------------
------------------------------------------------------------------------------

------------------------------------------------------------------------------
------------------------------------------------------------------------------

------------------------------------------------------------------------------
------------------------------------------------------------------------------

------------------------------------------------------------------------------
------------------------------------------------------------------------------
